{% extends base_template %}

{% block title %}Личный кабинет - Ветеринарная клиника "Друг"{% endblock %}

{% block content %}
<!-- Заголовок страницы -->
<div class="page-header">
    <div class="container">
        <h1>Личный кабинет</h1>
        <p>Управление записями и личными данными</p>
    </div>
</div>

<div class="profile-container">
    <div class="container">
        <div class="profile-wrapper">
            <!-- Боковая панель профиля -->
            <aside class="profile-sidebar">
                <div class="user-card">
                    <div class="user-avatar">
                        <img src="{{ url_for('static', filename='images/avatars/user' + (current_user.id % 5 + 1)|string + '.jpg') }}" alt="{{ current_user.full_name }}">
                        {% if current_user.role == 'admin' %}
                        <span class="user-badge admin">Админ</span>
                        {% elif current_user.role == 'staff' %}
                        <span class="user-badge staff">Сотрудник</span>
                        {% endif %}
                    </div>
                    
                    <div class="user-info">
                        <h3>{{ current_user.full_name }}</h3>
                        <p class="user-email">{{ current_user.email }}</p>
                        <p class="user-phone">{{ current_user.phone or 'Телефон не указан' }}</p>
                    </div>
                    
                    <div class="user-stats">
                        <div class="stat">
                            <span class="stat-number">{{ appointments|length }}</span>
                            <span class="stat-label">Записей</span>
                        </div>
                        <div class="stat">
                            <span class="stat-number">
                                {% set completed = appointments|selectattr('status', 'equalto', 'completed')|list|length %}
                                {{ completed }}
                            </span>
                            <span class="stat-label">Посещений</span>
                        </div>
                    </div>
                </div>
                
                <nav class="profile-menu">
                    <ul>
                        <li>
                            <a href="#appointments" class="menu-item active" data-tab="appointments">
                                <i class="fas fa-calendar-alt"></i>
                                <span>Мои записи</span>
                            </a>
                        </li>
                        <li>
                            <a href="#pets" class="menu-item" data-tab="pets">
                                <i class="fas fa-paw"></i>
                                <span>Мои питомцы</span>
                            </a>
                        </li>
                        <li>
                            <a href="#profile" class="menu-item" data-tab="profile">
                                <i class="fas fa-user"></i>
                                <span>Профиль</span>
                            </a>
                        </li>
                        {% if current_user.role in ['staff', 'admin'] %}
                        <li>
                            <a href="#schedule" class="menu-item" data-tab="schedule">
                                <i class="fas fa-clock"></i>
                                <span>Расписание</span>
                            </a>
                        </li>
                        {% endif %}
                        {% if current_user.role == 'admin' %}
                        <li>
                            <a href="#admin" class="menu-item" data-tab="admin">
                                <i class="fas fa-cog"></i>
                                <span>Администрирование</span>
                            </a>
                        </li>
                        {% endif %}
                        <li>
                            <a href="{{ url_for('logout') }}" class="menu-item logout">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Выход</span>
                            </a>
                        </li>
                    </ul>
                </nav>
                
                <!-- Быстрые действия -->
                <div class="quick-actions">
                    <h4>Быстрые действия</h4>
                    <a href="{{ url_for('contacts') }}" class="btn btn-primary btn-block">
                        <i class="fas fa-calendar-plus"></i> Новая запись
                    </a>
                    {% if current_user.role in ['staff', 'admin'] %}
                    <a href="#" class="btn btn-secondary btn-block" id="addNewsBtn">
                        <i class="fas fa-plus"></i> Добавить новость
                    </a>
                    {% endif %}
                </div>
            </aside>
            
            <!-- Основное содержимое -->
            <main class="profile-content">
                <!-- Вкладка "Мои записи" -->
                <div class="tab-content active" id="appointments-tab">
                    <div class="tab-header">
                        <h2>Мои записи</h2>
                        <a href="{{ url_for('contacts') }}" class="btn btn-primary">
                            <i class="fas fa-calendar-plus"></i> Записаться на прием
                        </a>
                    </div>
                    
                    {% if appointments %}
                    <div class="appointments-list">
                        {% for appointment in appointments %}
                        <div class="appointment-card {% if appointment.status == 'completed' %}completed{% elif appointment.status == 'cancelled' %}cancelled{% endif %}">
                            <div class="appointment-header">
                                <div class="appointment-date">
                                    <span class="date-day">{{ appointment.date_time.day }}</span>
                                    <span class="date-month">{{ appointment.date_time.strftime('%b') }}</span>
                                    <span class="date-time">{{ appointment.date_time.strftime('%H:%M') }}</span>
                                </div>
                                
                                <div class="appointment-status">
                                    {% if appointment.status == 'pending' %}
                                    <span class="status-badge pending">Ожидание</span>
                                    {% elif appointment.status == 'confirmed' %}
                                    <span class="status-badge confirmed">Подтверждено</span>
                                    {% elif appointment.status == 'completed' %}
                                    <span class="status-badge completed">Завершено</span>
                                    {% elif appointment.status == 'cancelled' %}
                                    <span class="status-badge cancelled">Отменено</span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="appointment-body">
                                <div class="appointment-info">
                                    <div class="info-item">
                                        <i class="fas fa-paw"></i>
                                        <div>
                                            <strong>Питомец:</strong>
                                            <span>{{ appointment.pet_name }} ({{ appointment.pet_species }})</span>
                                        </div>
                                    </div>
                                    
                                    <div class="info-item">
                                        <i class="fas fa-stethoscope"></i>
                                        <div>
                                            <strong>Услуга:</strong>
                                            <span>{{ appointment.service.name if appointment.service else 'Не указана' }}</span>
                                        </div>
                                    </div>
                                    
                                    <div class="info-item">
                                        <i class="fas fa-user-md"></i>
                                        <div>
                                            <strong>Врач:</strong>
                                            <span>{{ appointment.doctor.name if appointment.doctor else 'Любой доступный' }}</span>
                                        </div>
                                    </div>
                                </div>
                                
                                {% if appointment.notes %}
                                <div class="appointment-notes">
                                    <strong>Примечания:</strong>
                                    <p>{{ appointment.notes }}</p>
                                </div>
                                {% endif %}
                            </div>
                            
                            <div class="appointment-actions">
                                {% if appointment.status in ['pending', 'confirmed'] %}
                                <button class="btn btn-outline btn-sm" data-action="reschedule" data-id="{{ appointment.id }}">
                                    <i class="fas fa-calendar-alt"></i> Перенести
                                </button>
                                <button class="btn btn-outline btn-sm btn-danger" data-action="cancel" data-id="{{ appointment.id }}">
                                    <i class="fas fa-times"></i> Отменить
                                </button>
                                {% endif %}
                                
                                {% if current_user.role in ['staff', 'admin'] and appointment.status == 'pending' %}
                                <button class="btn btn-primary btn-sm" data-action="confirm" data-id="{{ appointment.id }}">
                                    <i class="fas fa-check"></i> Подтвердить
                                </button>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="empty-state">
                        <i class="fas fa-calendar-times fa-3x"></i>
                        <h3>У вас пока нет записей</h3>
                        <p>Запишитесь на прием к нашему специалисту</p>
                        <a href="{{ url_for('contacts') }}" class="btn btn-primary">Записаться на прием</a>
                    </div>
                    {% endif %}
                </div>
                
                <!-- Вкладка "Мои питомцы" -->
                <div class="tab-content" id="pets-tab">
                    <div class="tab-header">
                        <h2>Мои питомцы</h2>
                        <button class="btn btn-primary" id="addPetBtn">
                            <i class="fas fa-plus"></i> Добавить питомца
                        </button>
                    </div>
                    
                    <div class="pets-list">
                        <div class="pet-card">
                            <div class="pet-avatar">
                                <i class="fas fa-dog fa-2x"></i>
                            </div>
                            <div class="pet-info">
                                <h3>Шарик</h3>
                                <p>Собака, 5 лет</p>
                                <div class="pet-tags">
                                    <span class="tag">Вакцинирован</span>
                                    <span class="tag">Чипирован</span>
                                </div>
                            </div>
                            <div class="pet-actions">
                                <button class="btn btn-outline btn-sm">Редактировать</button>
                            </div>
                        </div>
                        
                        <div class="pet-card">
                            <div class="pet-avatar">
                                <i class="fas fa-cat fa-2x"></i>
                            </div>
                            <div class="pet-info">
                                <h3>Барсик</h3>
                                <p>Кошка, 3 года</p>
                                <div class="pet-tags">
                                    <span class="tag">Стерилизован</span>
                                </div>
                            </div>
                            <div class="pet-actions">
                                <button class="btn btn-outline btn-sm">Редактировать</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Форма добавления питомца -->
                    <div class="add-pet-form" id="addPetForm" style="display: none;">
                        <h3>Добавить питомца</h3>
                        <form id="newPetForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="petName">Имя питомца *</label>
                                    <input type="text" id="petName" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="petType">Вид *</label>
                                    <select id="petType" required>
                                        <option value="">Выберите вид</option>
                                        <option value="dog">Собака</option>
                                        <option value="cat">Кошка</option>
                                        <option value="rodent">Грызун</option>
                                        <option value="bird">Птица</option>
                                        <option value="other">Другое</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="petBreed">Порода</label>
                                    <input type="text" id="petBreed">
                                </div>
                                
                                <div class="form-group">
                                    <label for="petAge">Возраст (лет)</label>
                                    <input type="number" id="petAge" min="0" max="50">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="petWeight">Вес (кг)</label>
                                <input type="number" id="petWeight" min="0" step="0.1">
                            </div>
                            
                            <div class="form-group">
                                <label for="petNotes">Особенности</label>
                                <textarea id="petNotes" rows="3" placeholder="Аллергии, хронические заболевания и т.д."></textarea>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">Добавить питомца</button>
                                <button type="button" class="btn btn-outline" id="cancelAddPet">Отмена</button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Вкладка "Профиль" -->
                <div class="tab-content" id="profile-tab">
                    <div class="tab-header">
                        <h2>Настройки профиля</h2>
                    </div>
                    
                    <div class="profile-settings">
                        <form id="profileForm">
                            <div class="form-section">
                                <h3>Личные данные</h3>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="profileName">ФИО *</label>
                                        <input type="text" id="profileName" value="{{ current_user.full_name }}" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="profileEmail">Email *</label>
                                        <input type="email" id="profileEmail" value="{{ current_user.email }}" required>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="profilePhone">Телефон</label>
                                        <input type="tel" id="profilePhone" value="{{ current_user.phone or '' }}">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="profileBirthday">Дата рождения</label>
                                        <input type="date" id="profileBirthday">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <h3>Смена пароля</h3>
                                
                                <div class="form-group">
                                    <label for="currentPassword">Текущий пароль</label>
                                    <input type="password" id="currentPassword">
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="newPassword">Новый пароль</label>
                                        <input type="password" id="newPassword">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="confirmPassword">Повторите новый пароль</label>
                                        <input type="password" id="confirmPassword">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <h3>Настройки уведомлений</h3>
                                
                                <div class="form-check">
                                    <input type="checkbox" id="notifyEmail" checked>
                                    <label for="notifyEmail">Уведомления по email</label>
                                </div>
                                
                                <div class="form-check">
                                    <input type="checkbox" id="notifySMS" checked>
                                    <label for="notifySMS">Уведомления по SMS</label>
                                </div>
                                
                                <div class="form-check">
                                    <input type="checkbox" id="newsletter" checked>
                                    <label for="newsletter">Подписка на новости и акции</label>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">Сохранить изменения</button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Вкладка "Расписание" (для сотрудников) -->
                {% if current_user.role in ['staff', 'admin'] %}
                <div class="tab-content" id="schedule-tab">
                    <div class="tab-header">
                        <h2>Расписание</h2>
                        <div class="schedule-nav">
                            <button class="btn btn-outline" id="prevWeek">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <span id="currentWeek">Текущая неделя</span>
                            <button class="btn btn-outline" id="nextWeek">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="schedule-container">
                        <div class="schedule-header">
                            <div class="schedule-time">Время</div>
                            <div class="schedule-day">Пн</div>
                            <div class="schedule-day">Вт</div>
                            <div class="schedule-day">Ср</div>
                            <div class="schedule-day">Чт</div>
                            <div class="schedule-day">Пт</div>
                            <div class="schedule-day">Сб</div>
                        </div>
                        
                        <div class="schedule-body">
                            {% for hour in range(9, 19) %}
                            <div class="schedule-row">
                                <div class="schedule-time">{{ hour }}:00</div>
                                {% for day in range(1, 7) %}
                                <div class="schedule-cell" data-day="{{ day }}" data-hour="{{ hour }}">
                                    {% for appointment in appointments %}
                                    {% if appointment.date_time.weekday() == day-1 and appointment.date_time.hour == hour %}
                                    <div class="appointment-slot {{ appointment.status }}" 
                                         title="{{ appointment.pet_name }} - {{ appointment.service.name }}">
                                        <div class="slot-time">{{ appointment.date_time.strftime('%H:%M') }}</div>
                                        <div class="slot-info">
                                            <strong>{{ appointment.pet_name }}</strong>
                                            <small>{{ appointment.service.name }}</small>
                                        </div>
                                    </div>
                                    {% endif %}
                                    {% endfor %}
                                </div>
                                {% endfor %}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div class="today-appointments">
                        <h3>Записи на сегодня</h3>
                        {% if appointments %}
                        <div class="appointments-today">
                            {% for appointment in appointments[:5] %}
                            <div class="appointment-today">
                                <span class="appointment-time">{{ appointment.date_time.strftime('%H:%M') }}</span>
                                <div class="appointment-details">
                                    <strong>{{ appointment.pet_name }}</strong>
                                    <span>{{ appointment.service.name }}</span>
                                </div>
                                <div class="appointment-actions">
                                    <button class="btn btn-sm btn-outline" data-action="complete" data-id="{{ appointment.id }}">
                                        Завершить
                                    </button>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="empty-message">На сегодня записей нет</p>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                
                <!-- Вкладка "Администрирование" -->
                {% if current_user.role == 'admin' %}
                <div class="tab-content" id="admin-tab">
                    <div class="tab-header">
                        <h2>Панель администратора</h2>
                        <a href="{{ url_for('admin_panel') }}" class="btn btn-primary">
                            <i class="fas fa-cog"></i> Расширенная панель
                        </a>
                    </div>
                    
                    <div class="admin-stats">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-number">150</span>
                                <span class="stat-label">Всего клиентов</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-number">{{ appointments|length }}</span>
                                <span class="stat-label">Записей сегодня</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-number">85,430 ₽</span>
                                <span class="stat-label">Выручка за день</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-number">4.8</span>
                                <span class="stat-label">Средняя оценка</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="admin-actions">
                        <h3>Быстрые действия</h3>
                        <div class="actions-grid">
                            <a href="{{ url_for('register_staff') }}" class="action-card">
                                <i class="fas fa-user-plus"></i>
                                <span>Добавить сотрудника</span>
                            </a>
                            
                            <a href="#" class="action-card" id="addServiceBtn">
                                <i class="fas fa-plus-circle"></i>
                                <span>Добавить услугу</span>
                            </a>
                            
                            <a href="#" class="action-card">
                                <i class="fas fa-chart-bar"></i>
                                <span>Статистика</span>
                            </a>
                            
                            <a href="#" class="action-card">
                                <i class="fas fa-cog"></i>
                                <span>Настройки системы</span>
                            </a>
                        </div>
                    </div>
                    
                    <div class="recent-activity">
                        <h3>Последняя активность</h3>
                        <div class="activity-list">
                            <div class="activity-item">
                                <div class="activity-icon success">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div class="activity-content">
                                    <p>Новый пользователь зарегистрирован</p>
                                    <span class="activity-time">10 минут назад</span>
                                </div>
                            </div>
                            
                            <div class="activity-item">
                                <div class="activity-icon warning">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="activity-content">
                                    <p>Запись отменена пользователем</p>
                                    <span class="activity-time">1 час назад</span>
                                </div>
                            </div>
                            
                            <div class="activity-item">
                                <div class="activity-icon info">
                                    <i class="fas fa-info-circle"></i>
                                </div>
                                <div class="activity-content">
                                    <p>Добавлена новая услуга</p>
                                    <span class="activity-time">2 часа назад</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
            </main>
        </div>
    </div>
</div>

<!-- Модальное окно для добавления новости -->
<div class="modal" id="addNewsModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Добавить новость</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addNewsForm">
                    <div class="form-group">
                        <label for="newsTitle">Заголовок *</label>
                        <input type="text" id="newsTitle" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="newsContent">Содержание *</label>
                        <textarea id="newsContent" rows="5" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="newsCategory">Категория</label>
                        <select id="newsCategory">
                            <option value="акция">Акция</option>
                            <option value="событие">Событие</option>
                            <option value="обновление">Обновление</option>
                            <option value="важно">Важная информация</option>
                        </select>
                    </div>
                    
                    <div class="form-check">
                        <input type="checkbox" id="newsPublished" checked>
                        <label for="newsPublished">Опубликовать сразу</label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                <button type="button" class="btn btn-primary" id="saveNewsBtn">Сохранить</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.page-header {
    background: linear-gradient(135deg, var(--primary-color), var(--dark-color));
    color: white;
    padding: 80px 0;
    text-align: center;
    margin-bottom: 40px;
}

.page-header h1 {
    color: white;
    font-size: 3rem;
    margin-bottom: 15px;
}

.profile-wrapper {
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 40px;
    margin-bottom: 60px;
}

@media (max-width: 992px) {
    .profile-wrapper {
        grid-template-columns: 1fr;
    }
}

/* Боковая панель */
.user-card {
    background: white;
    padding: 30px;
    border-radius: 15px;
    text-align: center;
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    margin-bottom: 30px;
}

.user-avatar {
    position: relative;
    width: 120px;
    height: 120px;
    margin: 0 auto 20px;
}

.user-avatar img {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
    border: 5px solid var(--light-color);
}

.user-badge {
    position: absolute;
    bottom: 0;
    right: 0;
    padding: 5px 10px;
    border-radius: 15px;
    font-size: 0.8rem;
    font-weight: 600;
    color: white;
}

.user-badge.admin {
    background: var(--primary-color);
}

.user-badge.staff {
    background: var(--warning);
    color: var(--dark-color);
}

.user-info h3 {
    margin: 0 0 10px 0;
    color: var(--dark-color);
}

.user-email, .user-phone {
    color: var(--gray);
    margin: 5px 0;
    font-size: 0.95rem;
}

.user-stats {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid var(--gray-light);
}

.stat {
    text-align: center;
}

.stat-number {
    display: block;
    font-size: 1.8rem;
    font-weight: bold;
    color: var(--primary-color);
    line-height: 1;
}

.stat-label {
    display: block;
    font-size: 0.9rem;
    color: var(--gray);
    margin-top: 5px;
}

.profile-menu ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.menu-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px 20px;
    color: var(--dark-color);
    text-decoration: none;
    border-radius: 10px;
    margin-bottom: 10px;
    transition: all 0.3s ease;
}

.menu-item:hover,
.menu-item.active {
    background: var(--primary-color);
    color: white;
}

.menu-item.logout {
    color: var(--danger);
}

.menu-item.logout:hover {
    background: var(--danger);
    color: white;
}

.menu-item i {
    width: 20px;
    text-align: center;
}

.quick-actions {
    background: white;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    margin-top: 30px;
}

.quick-actions h4 {
    margin-top: 0;
    margin-bottom: 15px;
    color: var(--dark-color);
}

.btn-block {
    width: 100%;
    margin-bottom: 10px;
}

/* Основное содержимое */
.profile-content {
    background: white;
    border-radius: 15px;
    padding: 30px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.tab-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 1px solid var(--gray-light);
}

.tab-header h2 {
    margin: 0;
    color: var(--dark-color);
}

/* Записи */
.appointment-card {
    background: var(--light-color);
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
    border-left: 4px solid var(--primary-color);
}

.appointment-card.completed {
    border-left-color: var(--success);
    opacity: 0.8;
}

.appointment-card.cancelled {
    border-left-color: var(--danger);
    opacity: 0.6;
}

.appointment-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 20px;
}

.appointment-date {
    display: flex;
    align-items: center;
    gap: 10px;
}

.date-day {
    font-size: 2rem;
    font-weight: bold;
    color: var(--primary-color);
}

.date-month {
    text-transform: uppercase;
    color: var(--gray);
    font-weight: 600;
}

.date-time {
    background: white;
    padding: 5px 10px;
    border-radius: 20px;
    font-weight: 600;
    color: var(--dark-color);
}

.status-badge {
    display: inline-block;
    padding: 5px 15px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
}

.status-badge.pending {
    background: #fff3cd;
    color: #856404;
}

.status-badge.confirmed {
    background: #d4edda;
    color: #155724;
}

.status-badge.completed {
    background: #d1ecf1;
    color: #0c5460;
}

.status-badge.cancelled {
    background: #f8d7da;
    color: #721c24;
}

.appointment-info {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
}

.info-item {
    display: flex;
    align-items: center;
    gap: 15px;
}

.info-item i {
    color: var(--primary-color);
    font-size: 1.2rem;
}

.info-item strong {
    display: block;
    color: var(--gray);
    font-size: 0.9rem;
    margin-bottom: 5px;
}

.info-item span {
    display: block;
    color: var(--dark-color);
    font-weight: 600;
}

.appointment-notes {
    background: white;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
}

.appointment-notes p {
    margin: 10px 0 0 0;
    color: var(--gray);
}

.appointment-actions {
    display: flex;
    gap: 10px;
}

.btn-sm {
    padding: 8px 15px;
    font-size: 0.9rem;
}

.btn-danger {
    background: var(--danger);
    color: white;
}

.btn-danger:hover {
    background: #c82333;
}

.empty-state {
    text-align: center;
    padding: 60px 20px;
}

.empty-state i {
    color: var(--gray-light);
    margin-bottom: 20px;
}

.empty-state h3 {
    color: var(--dark-color);
    margin-bottom: 10px;
}

.empty-state p {
    color: var(--gray);
    margin-bottom: 30px;
}

/* Питомцы */
.pets-list {
    display: grid;
    gap: 20px;
    margin-bottom: 30px;
}

.pet-card {
    display: flex;
    align-items: center;
    gap: 20px;
    padding: 20px;
    background: var(--light-color);
    border-radius: 10px;
}

.pet-avatar {
    width: 60px;
    height: 60px;
    background: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary-color);
}

.pet-info h3 {
    margin: 0 0 5px 0;
    color: var(--dark-color);
}

.pet-info p {
    margin: 0 0 10px 0;
    color: var(--gray);
}

.pet-tags {
    display: flex;
    gap: 10px;
}

.tag {
    display: inline-block;
    padding: 3px 10px;
    background: white;
    color: var(--primary-color);
    border-radius: 15px;
    font-size: 0.8rem;
    font-weight: 600;
}

.add-pet-form {
    background: var(--light-color);
    padding: 30px;
    border-radius: 10px;
    margin-top: 30px;
}

.add-pet-form h3 {
    margin-top: 0;
    margin-bottom: 20px;
    color: var(--dark-color);
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

@media (max-width: 768px) {
    .form-row {
        grid-template-columns: 1fr;
    }
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: var(--dark-color);
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid var(--gray-light);
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.3s ease;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: var(--primary-color);
}

.form-actions {
    display: flex;
    gap: 15px;
    margin-top: 30px;
}

/* Профиль */
.profile-settings {
    max-width: 800px;
}

.form-section {
    margin-bottom: 40px;
    padding-bottom: 30px;
    border-bottom: 1px solid var(--gray-light);
}

.form-section h3 {
    margin-top: 0;
    margin-bottom: 25px;
    color: var(--dark-color);
}

.form-check {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
}

.form-check input {
    width: 18px;
    height: 18px;
}

/* Расписание */
.schedule-nav {
    display: flex;
    align-items: center;
    gap: 15px;
}

#currentWeek {
    min-width: 150px;
    text-align: center;
    font-weight: 600;
}

.schedule-container {
    border: 1px solid var(--gray-light);
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 30px;
}

.schedule-header {
    display: grid;
    grid-template-columns: 100px repeat(6, 1fr);
    background: var(--primary-color);
    color: white;
}

.schedule-time,
.schedule-day {
    padding: 15px;
    text-align: center;
    font-weight: 600;
}

.schedule-body {
    max-height: 500px;
    overflow-y: auto;
}

.schedule-row {
    display: grid;
    grid-template-columns: 100px repeat(6, 1fr);
    border-bottom: 1px solid var(--gray-light);
}

.schedule-row:last-child {
    border-bottom: none;
}

.schedule-cell {
    padding: 10px;
    border-right: 1px solid var(--gray-light);
    min-height: 60px;
}

.schedule-cell:last-child {
    border-right: none;
}

.appointment-slot {
    background: var(--primary-color);
    color: white;
    padding: 5px;
    border-radius: 5px;
    font-size: 0.8rem;
    cursor: pointer;
    margin-bottom: 5px;
}

.appointment-slot:hover {
    opacity: 0.9;
}

.appointment-slot.pending {
    background: #ffc107;
}

.appointment-slot.confirmed {
    background: #28a745;
}

.appointment-slot.completed {
    background: #6c757d;
}

.slot-time {
    font-weight: bold;
    font-size: 0.7rem;
}

.slot-info {
    overflow: hidden;
}

.slot-info strong {
    display: block;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-size: 0.75rem;
}

.slot-info small {
    display: block;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-size: 0.7rem;
    opacity: 0.8;
}

.today-appointments {
    background: var(--light-color);
    padding: 25px;
    border-radius: 10px;
}

.today-appointments h3 {
    margin-top: 0;
    margin-bottom: 20px;
    color: var(--dark-color);
}

.appointments-today {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.appointment-today {
    display: flex;
    align-items: center;
    gap: 20px;
    padding: 15px;
    background: white;
    border-radius: 8px;
}

.appointment-time {
    font-weight: bold;
    color: var(--primary-color);
    min-width: 60px;
}

.appointment-details {
    flex-grow: 1;
}

.appointment-details strong {
    display: block;
    color: var(--dark-color);
    margin-bottom: 5px;
}

.appointment-details span {
    color: var(--gray);
    font-size: 0.9rem;
}

.empty-message {
    color: var(--gray);
    font-style: italic;
    text-align: center;
    padding: 20px;
}

/* Администрирование */
.admin-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
}

.stat-card {
    background: var(--light-color);
    padding: 20px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    gap: 20px;
}

.stat-icon {
    width: 50px;
    height: 50px;
    background: var(--primary-color);
    color: white;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
}

.stat-info {
    flex-grow: 1;
}

.stat-number {
    display: block;
    font-size: 1.8rem;
    font-weight: bold;
    color: var(--dark-color);
    line-height: 1;
}

.stat-label {
    display: block;
    color: var(--gray);
    font-size: 0.9rem;
    margin-top: 5px;
}

.admin-actions {
    margin-bottom: 40px;
}

.admin-actions h3 {
    margin-bottom: 20px;
    color: var(--dark-color);
}

.actions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
}

.action-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 30px 20px;
    background: var(--light-color);
    border-radius: 10px;
    text-decoration: none;
    color: var(--dark-color);
    text-align: center;
    transition: all 0.3s ease;
}

.action-card:hover {
    background: var(--primary-color);
    color: white;
    transform: translateY(-5px);
}

.action-card i {
    font-size: 2rem;
    margin-bottom: 15px;
}

.action-card span {
    font-weight: 600;
}

.recent-activity h3 {
    margin-bottom: 20px;
    color: var(--dark-color);
}

.activity-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.activity-item {
    display: flex;
    align-items: flex-start;
    gap: 15px;
    padding: 15px;
    background: var(--light-color);
    border-radius: 10px;
}

.activity-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.activity-icon.success {
    background: #d4edda;
    color: #155724;
}

.activity-icon.warning {
    background: #fff3cd;
    color: #856404;
}

.activity-icon.info {
    background: #d1ecf1;
    color: #0c5460;
}

.activity-content {
    flex-grow: 1;
}

.activity-content p {
    margin: 0 0 5px 0;
    color: var(--dark-color);
}

.activity-time {
    font-size: 0.85rem;
    color: var(--gray);
}

/* Модальные окна */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 1000;
    overflow-y: auto;
}

.modal.show {
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-dialog {
    background: white;
    border-radius: 15px;
    max-width: 500px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
}

.modal-content {
    padding: 30px;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--gray-light);
}

.modal-title {
    margin: 0;
    color: var(--dark-color);
}

.close {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--gray);
}

.close:hover {
    color: var(--dark-color);
}

.modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid var(--gray-light);
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Переключение вкладок
    const menuItems = document.querySelectorAll('.menu-item[data-tab]');
    const tabContents = document.querySelectorAll('.tab-content');
    
    menuItems.forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault();
            
            const tabId = this.dataset.tab;
            
            // Убираем активный класс у всех пунктов меню и вкладок
            menuItems.forEach(i => i.classList.remove('active'));
            tabContents.forEach(tab => tab.classList.remove('active'));
            
            // Добавляем активный класс текущему пункту меню и соответствующей вкладке
            this.classList.add('active');
            document.getElementById(`${tabId}-tab`).classList.add('active');
        });
    });
    
    // Управление записями
    const appointmentActions = document.querySelectorAll('[data-action]');
    
    appointmentActions.forEach(button => {
        button.addEventListener('click', function() {
            const action = this.dataset.action;
            const appointmentId = this.dataset.id;
            
            switch(action) {
                case 'reschedule':
                    alert(`Перенос записи #${appointmentId}. Функция в разработке.`);
                    break;
                    
                case 'cancel':
                    if (confirm('Вы уверены, что хотите отменить запись?')) {
                        // Здесь AJAX запрос на отмену
                        alert(`Запись #${appointmentId} отменена.`);
                        this.closest('.appointment-card').style.opacity = '0.5';
                    }
                    break;
                    
                case 'confirm':
                    if (confirm('Подтвердить запись?')) {
                        // Здесь AJAX запрос на подтверждение
                        alert(`Запись #${appointmentId} подтверждена.`);
                        this.closest('.appointment-card').querySelector('.status-badge').className = 'status-badge confirmed';
                        this.closest('.appointment-card').querySelector('.status-badge').textContent = 'Подтверждено';
                    }
                    break;
                    
                case 'complete':
                    if (confirm('Завершить прием?')) {
                        // Здесь AJAX запрос на завершение
                        alert(`Прием #${appointmentId} завершен.`);
                        this.closest('.appointment-today').style.opacity = '0.5';
                    }
                    break;
            }
        });
    });
    
    // Добавление питомца
    const addPetBtn = document.getElementById('addPetBtn');
    const addPetForm = document.getElementById('addPetForm');
    const cancelAddPet = document.getElementById('cancelAddPet');
    const newPetForm = document.getElementById('newPetForm');
    
    if (addPetBtn) {
        addPetBtn.addEventListener('click', function() {
            addPetForm.style.display = 'block';
            this.style.display = 'none';
        });
    }
    
    if (cancelAddPet) {
        cancelAddPet.addEventListener('click', function() {
            addPetForm.style.display = 'none';
            addPetBtn.style.display = 'block';
            newPetForm.reset();
        });
    }
    
    if (newPetForm) {
        newPetForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const petName = document.getElementById('petName').value;
            
            alert(`Питомец "${petName}" добавлен!`);
            this.reset();
            addPetForm.style.display = 'none';
            addPetBtn.style.display = 'block';
        });
    }
    
    // Сохранение профиля
    const profileForm = document.getElementById('profileForm');
    
    if (profileForm) {
        profileForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Валидация пароля
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (newPassword && newPassword !== confirmPassword) {
                alert('Пароли не совпадают!');
                return;
            }
            
            alert('Изменения профиля сохранены!');
            // Здесь AJAX запрос на сохранение
        });
    }
    
    // Расписание (навигация по неделям)
    const prevWeekBtn = document.getElementById('prevWeek');
    const nextWeekBtn = document.getElementById('nextWeek');
    const currentWeekSpan = document.getElementById('currentWeek');
    
    let currentWeek = 0;
    
    function updateWeekDisplay() {
        const today = new Date();
        const startOfWeek = new Date(today);
        startOfWeek.setDate(today.getDate() - today.getDay() + 1 + currentWeek * 7);
        const endOfWeek = new Date(startOfWeek);
        endOfWeek.setDate(startOfWeek.getDate() + 6);
        
        const options = { day: 'numeric', month: 'long' };
        currentWeekSpan.textContent = 
            `${startOfWeek.toLocaleDateString('ru-RU', options)} - ${endOfWeek.toLocaleDateString('ru-RU', options)}`;
    }
    
    if (prevWeekBtn && nextWeekBtn) {
        prevWeekBtn.addEventListener('click', function() {
            currentWeek--;
            updateWeekDisplay();
        });
        
        nextWeekBtn.addEventListener('click', function() {
            currentWeek++;
            updateWeekDisplay();
        });
        
        updateWeekDisplay();
    }
    
    // Добавление новости (для сотрудников)
    const addNewsBtn = document.getElementById('addNewsBtn');
    const addNewsModal = document.getElementById('addNewsModal');
    const saveNewsBtn = document.getElementById('saveNewsBtn');
    const closeButtons = document.querySelectorAll('.close, .btn-secondary[data-dismiss="modal"]');
    
    if (addNewsBtn) {
        addNewsBtn.addEventListener('click', function() {
            addNewsModal.classList.add('show');
            document.body.style.overflow = 'hidden';
        });
    }
    
    if (saveNewsBtn) {
        saveNewsBtn.addEventListener('click', function() {
            const title = document.getElementById('newsTitle').value;
            const content = document.getElementById('newsContent').value;
            
            if (!title || !content) {
                alert('Заполните все обязательные поля');
                return;
            }
            
            alert(`Новость "${title}" добавлена!`);
            document.getElementById('addNewsForm').reset();
            addNewsModal.classList.remove('show');
            document.body.style.overflow = '';
        });
    }
    
    // Закрытие модальных окон
    closeButtons.forEach(button => {
        button.addEventListener('click', function() {
            const modal = this.closest('.modal');
            if (modal) {
                modal.classList.remove('show');
                document.body.style.overflow = '';
            }
        });
    });
    
    // Закрытие по клику вне модального окна
    const modals = document.querySelectorAll('.modal');
    
    modals.forEach(modal => {
        modal.addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.remove('show');
                document.body.style.overflow = '';
            }
        });
    });
    
    // Маска для телефона в профиле
    const phoneInput = document.getElementById('profilePhone');
    
    if (phoneInput) {
        phoneInput.addEventListener('input', function(e) {
            let value = this.value.replace(/\D/g, '');
            if (value.length > 0) {
                value = '+7 (' + value.substring(1, 4) + ') ' + 
                        value.substring(4, 7) + '-' + 
                        value.substring(7, 9) + '-' + 
                        value.substring(9, 11);
            }
            this.value = value.substring(0, 18);
        });
    }
    
    // Добавление услуги (админ)
    const addServiceBtn = document.getElementById('addServiceBtn');
    
    if (addServiceBtn) {
        addServiceBtn.addEventListener('click', function(e) {
            e.preventDefault();
            alert('Форма добавления услуги в разработке');
        });
    }
});
</script>
{% endblock %}