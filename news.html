{% extends base_template %}

{% block title %}Новости клиники - Ветеринарная клиника "Друг"{% endblock %}

{% block content %}
<!-- Заголовок страницы -->
<div class="page-header">
    <div class="container">
        <h1>Новости клиники</h1>
        <p>Следите за нашими акциями, событиями и обновлениями</p>
    </div>
</div>

<!-- Фильтр новостей -->
<section class="news-filter">
    <div class="container">
        <div class="filter-options">
            <div class="filter-group">
                <label for="newsCategory">Категория:</label>
                <select id="newsCategory">
                    <option value="all">Все новости</option>
                    <option value="акция">Акции</option>
                    <option value="событие">События</option>
                    <option value="обновление">Обновления</option>
                    <option value="важно">Важная информация</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="newsYear">Год:</label>
                <select id="newsYear">
                    <option value="all">Все годы</option>
                    <option value="2024">2024</option>
                    <option value="2023">2023</option>
                    <option value="2022">2022</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="newsSort">Сортировка:</label>
                <select id="newsSort">
                    <option value="newest">Сначала новые</option>
                    <option value="oldest">Сначала старые</option>
                </select>
            </div>
        </div>
        
        <div class="search-news">
            <input type="text" id="newsSearch" placeholder="Поиск по новостям...">
            <button id="searchNewsBtn">
                <i class="fas fa-search"></i>
            </button>
        </div>
    </div>
</section>

<!-- Основной контент -->
<section class="news-main">
    <div class="container">
        <div class="news-wrapper">
            <!-- Основная колонка с новостями -->
            <div class="news-column">
                <div class="news-list" id="newsList">
                    {% for item in news %}
                    <article class="news-item" id="news-{{ item.id }}" 
                             data-category="{% if 'акция' in item.title.lower() %}акция{% elif 'открыт' in item.title.lower() %}событие{% else %}обновление{% endif %}"
                             data-year="{{ item.created_at.year }}">
                        <div class="news-header">
                            <div class="news-date">
                                <span class="date-day">{{ item.created_at.day }}</span>
                                <span class="date-month">{{ item.created_at.strftime('%b') }}</span>
                                <span class="date-year">{{ item.created_at.year }}</span>
                            </div>
                            
                            <div class="news-category">
                                {% if 'акция' in item.title.lower() %}
                                <span class="category-badge sale">Акция</span>
                                {% elif 'открыт' in item.title.lower() %}
                                <span class="category-badge event">Событие</span>
                                {% else %}
                                <span class="category-badge update">Обновление</span>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="news-content">
                            <h2 class="news-title">{{ item.title }}</h2>
                            
                            <div class="news-excerpt">
                                <p>{{ item.content[:200] }}...</p>
                            </div>
                            
                            <div class="news-meta">
                                <span class="news-author">
                                    <i class="fas fa-user"></i> Администрация клиники
                                </span>
                                <span class="news-readtime">
                                    <i class="far fa-clock"></i> {{ (item.content|length / 1000)|round|int }} мин. чтения
                                </span>
                            </div>
                            
                            <div class="news-actions">
                                <a href="#news-{{ item.id }}" class="btn btn-outline read-more-btn">
                                    <i class="fas fa-newspaper"></i> Подробнее
                                </a>
                                <div class="news-share">
                                    <button class="share-btn" data-platform="vk" data-title="{{ item.title }}">
                                        <i class="fab fa-vk"></i>
                                    </button>
                                    <button class="share-btn" data-platform="telegram" data-title="{{ item.title }}">
                                        <i class="fab fa-telegram"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Полный текст новости (скрыт по умолчанию) -->
                        <div class="news-full" style="display: none;">
                            <div class="news-full-content">
                                {{ item.content|replace('\n', '</p><p>')|safe }}
                                
                                <div class="news-contact">
                                    <h3>По всем вопросам:</h3>
                                    <p>Телефон: +7 (495) 123-45-67</p>
                                    <p>Email: info@vetdrug.ru</p>
                                </div>
                            </div>
                            
                            <button class="btn btn-outline hide-full-btn">
                                <i class="fas fa-chevron-up"></i> Свернуть
                            </button>
                        </div>
                    </article>
                    {% endfor %}
                </div>
                
                <!-- Пагинация -->
                <div class="news-pagination">
                    <button class="page-btn prev" disabled>
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    
                    <div class="page-numbers">
                        <button class="page-number active">1</button>
                        <button class="page-number">2</button>
                        <button class="page-number">3</button>
                    </div>
                    
                    <button class="page-btn next">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                
                <!-- Сообщение, если новости не найдены -->
                <div id="noNewsMessage" class="no-news" style="display: none;">
                    <div class="no-news-content">
                        <i class="fas fa-newspaper fa-3x"></i>
                        <h3>Новости не найдены</h3>
                        <p>Попробуйте изменить параметры поиска или выберите другую категорию</p>
                        <button id="resetNewsFilters" class="btn btn-primary">Сбросить фильтры</button>
                    </div>
                </div>
            </div>
            
            <!-- Боковая колонка -->
            <aside class="sidebar-column">
                <!-- Подписка на новости -->
                <div class="sidebar-widget subscribe-widget">
                    <h3>Подпишитесь на новости</h3>
                    <p>Получайте актуальные новости и акции на почту</p>
                    <form class="subscribe-form">
                        <input type="email" placeholder="Ваш email" required>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-envelope"></i> Подписаться
                        </button>
                    </form>
                </div>
                
                <!-- Архив новостей -->
                <div class="sidebar-widget archive-widget">
                    <h3>Архив новостей</h3>
                    <div class="archive-years">
                        <a href="#" class="year-link active">2024</a>
                        <a href="#" class="year-link">2023</a>
                        <a href="#" class="year-link">2022</a>
                        <a href="#" class="year-link">2021</a>
                    </div>
                    
                    <div class="archive-months">
                        <h4>2024 год</h4>
                        <div class="month-grid">
                            <a href="#" class="month-link">Январь</a>
                            <a href="#" class="month-link">Февраль</a>
                            <a href="#" class="month-link">Март</a>
                            <a href="#" class="month-link">Апрель</a>
                            <a href="#" class="month-link">Май</a>
                            <a href="#" class="month-link">Июнь</a>
                            <a href="#" class="month-link">Июль</a>
                            <a href="#" class="month-link">Август</a>
                            <a href="#" class="month-link">Сентябрь</a>
                            <a href="#" class="month-link">Октябрь</a>
                            <a href="#" class="month-link">Ноябрь</a>
                            <a href="#" class="month-link">Декабрь</a>
                        </div>
                    </div>
                </div>
                
                <!-- Актуальные акции -->
                <div class="sidebar-widget promotions-widget">
                    <h3>Актуальные акции</h3>
                    <div class="promotion-item">
                        <div class="promotion-badge">-20%</div>
                        <div class="promotion-info">
                            <h4>Первичный прием</h4>
                            <p>Скидка 20% на первый визит</p>
                            <a href="{{ url_for('contacts') }}" class="promotion-link">Подробнее →</a>
                        </div>
                    </div>
                    
                    <div class="promotion-item">
                        <div class="promotion-badge">-15%</div>
                        <div class="promotion-info">
                            <h4>Для пенсионеров</h4>
                            <p>Постоянная скидка 15%</p>
                            <a href="{{ url_for('contacts') }}" class="promotion-link">Подробнее →</a>
                        </div>
                    </div>
                    
                    <div class="promotion-item">
                        <div class="promotion-badge">Комплекс</div>
                        <div class="promotion-info">
                            <h4>Комплексный осмотр</h4>
                            <p>Специальная цена на чек-ап</p>
                            <a href="{{ url_for('contacts') }}" class="promotion-link">Подробнее →</a>
                        </div>
                    </div>
                </div>
                
                <!-- Быстрые ссылки -->
                <div class="sidebar-widget links-widget">
                    <h3>Полезные ссылки</h3>
                    <ul class="quick-links">
                        <li><a href="{{ url_for('services') }}"><i class="fas fa-stethoscope"></i> Услуги и цены</a></li>
                        <li><a href="{{ url_for('doctors') }}"><i class="fas fa-user-md"></i> Наши врачи</a></li>
                        <li><a href="{{ url_for('articles') }}"><i class="fas fa-newspaper"></i> Полезные статьи</a></li>
                        <li><a href="{{ url_for('contacts') }}"><i class="fas fa-address-book"></i> Запись на прием</a></li>
                        <li><a href="{{ url_for('sitemap') }}"><i class="fas fa-sitemap"></i> Карта сайта</a></li>
                    </ul>
                </div>
            </aside>
        </div>
    </div>
</section>

<!-- Новостная рассылка -->
<section class="newsletter-section bg-primary text-white">
    <div class="container">
        <div class="newsletter-content">
            <div class="newsletter-text">
                <h2>Не пропустите важные новости!</h2>
                <p>Подпишитесь на нашу рассылку и получайте информацию об акциях и событиях первыми</p>
            </div>
            
            <form class="newsletter-form">
                <div class="form-group">
                    <input type="email" placeholder="Введите ваш email" required>
                    <button type="submit" class="btn btn-light">
                        <i class="fas fa-paper-plane"></i> Подписаться
                    </button>
                </div>
                <div class="form-check">
                    <input type="checkbox" id="newsletterAgree" required>
                    <label for="newsletterAgree">
                        Соглашаюсь на обработку персональных данных
                    </label>
                </div>
            </form>
        </div>
    </div>
</section>

<!-- Популярные новости -->
<section class="popular-news">
    <div class="container">
        <div class="section-header">
            <h2>Самые обсуждаемые новости</h2>
            <p class="section-subtitle">Что читают другие</p>
        </div>
        
        <div class="popular-grid">
            <div class="popular-news-item">
                <div class="popular-image">
                    <img src="{{ url_for('static', filename='images/news/popular1.jpg') }}" alt="Популярная новость 1">
                </div>
                <div class="popular-content">
                    <span class="popular-category">Акция</span>
                    <h3>Открытие нового отделения реабилитации</h3>
                    <div class="popular-meta">
                        <span class="popular-date">12.04.2024</span>
                        <span class="popular-comments">
                            <i class="fas fa-comment"></i> 24
                        </span>
                    </div>
                    <a href="#" class="read-link">Читать →</a>
                </div>
            </div>
            
            <div class="popular-news-item">
                <div class="popular-image">
                    <img src="{{ url_for('static', filename='images/news/popular2.jpg') }}" alt="Популярная новость 2">
                </div>
                <div class="popular-content">
                    <span class="popular-category">Событие</span>
                    <h3>Наша клиника получила международную сертификацию</h3>
                    <div class="popular-meta">
                        <span class="popular-date">05.04.2024</span>
                        <span class="popular-comments">
                            <i class="fas fa-comment"></i> 18
                        </span>
                    </div>
                    <a href="#" class="read-link">Читать →</a>
                </div>
            </div>
            
            <div class="popular-news-item">
                <div class="popular-image">
                    <img src="{{ url_for('static', filename='images/news/popular3.jpg') }}" alt="Популярная новость 3">
                </div>
                <div class="popular-content">
                    <span class="popular-category">Акция</span>
                    <h3>Специальная цена на стерилизацию кошек</h3>
                    <div class="popular-meta">
                        <span class="popular-date">28.03.2024</span>
                        <span class="popular-comments">
                            <i class="fas fa-comment"></i> 32
                        </span>
                    </div>
                    <a href="#" class="read-link">Читать →</a>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_css %}
<style>
.page-header {
    background: linear-gradient(135deg, var(--primary-color), var(--dark-color));
    color: white;
    padding: 80px 0;
    text-align: center;
    margin-bottom: 40px;
}

.page-header h1 {
    color: white;
    font-size: 3rem;
    margin-bottom: 15px;
}

/* Фильтр новостей */
.news-filter {
    background: white;
    padding: 25px 0;
    border-bottom: 1px solid var(--gray-light);
    margin-bottom: 40px;
}

.filter-options {
    display: flex;
    flex-wrap: wrap;
    gap: 30px;
    margin-bottom: 20px;
}

.filter-group {
    display: flex;
    align-items: center;
    gap: 10px;
}

.filter-group label {
    font-weight: 600;
    color: var(--dark-color);
    white-space: nowrap;
}

.filter-group select {
    padding: 10px 15px;
    border: 2px solid var(--gray-light);
    border-radius: 8px;
    background: white;
    color: var(--dark-color);
    font-size: 1rem;
    min-width: 150px;
    cursor: pointer;
    outline: none;
}

.filter-group select:focus {
    border-color: var(--primary-color);
}

.search-news {
    display: flex;
    max-width: 400px;
}

.search-news input {
    flex-grow: 1;
    padding: 12px 20px;
    border: 2px solid var(--gray-light);
    border-radius: 30px 0 0 30px;
    font-size: 1rem;
    outline: none;
}

.search-news button {
    background: var(--primary-color);
    color: white;
    border: none;
    padding: 0 30px;
    border-radius: 0 30px 30px 0;
    cursor: pointer;
    font-size: 1.1rem;
}

/* Основной контент */
.news-wrapper {
    display: grid;
    grid-template-columns: 1fr 300px;
    gap: 50px;
}

@media (max-width: 992px) {
    .news-wrapper {
        grid-template-columns: 1fr;
    }
}

/* Список новостей */
.news-list {
    display: flex;
    flex-direction: column;
    gap: 30px;
}

.news-item {
    background: white;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    transition: transform 0.3s ease;
}

.news-item:hover {
    transform: translateY(-5px);
}

.news-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 25px 25px 0;
}

.news-date {
    display: flex;
    flex-direction: column;
    align-items: center;
    background: var(--primary-color);
    color: white;
    padding: 15px;
    border-radius: 10px;
    min-width: 70px;
}

.date-day {
    font-size: 2rem;
    font-weight: bold;
    line-height: 1;
}

.date-month {
    font-size: 1rem;
    text-transform: uppercase;
    margin: 5px 0;
}

.date-year {
    font-size: 0.9rem;
    opacity: 0.8;
}

.category-badge {
    display: inline-block;
    padding: 8px 15px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
    text-transform: uppercase;
}

.category-badge.sale {
    background: #ff6b6b;
    color: white;
}

.category-badge.event {
    background: #4ecdc4;
    color: white;
}

.category-badge.update {
    background: #45b7d1;
    color: white;
}

.category-badge.important {
    background: #ff9f43;
    color: white;
}

.news-content {
    padding: 25px;
}

.news-title {
    margin: 0 0 15px 0;
    color: var(--dark-color);
    font-size: 1.5rem;
    line-height: 1.3;
}

.news-excerpt {
    margin-bottom: 20px;
    color: var(--gray);
    line-height: 1.6;
}

.news-meta {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
    color: var(--gray);
    font-size: 0.9rem;
}

.news-meta i {
    margin-right: 5px;
}

.news-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 20px;
    border-top: 1px solid var(--gray-light);
}

.read-more-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.news-share {
    display: flex;
    gap: 10px;
}

.share-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: none;
    background: var(--light-color);
    color: var(--dark-color);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.share-btn:hover {
    transform: scale(1.1);
}

.share-btn[data-platform="vk"]:hover {
    background: #4C75A3;
    color: white;
}

.share-btn[data-platform="telegram"]:hover {
    background: #2AABEE;
    color: white;
}

/* Полный текст новости */
.news-full {
    padding: 0 25px 25px;
    border-top: 1px solid var(--gray-light);
    margin-top: 20px;
}

.news-full-content {
    padding: 25px 0;
    line-height: 1.8;
    color: var(--dark-color);
}

.news-full-content h2,
.news-full-content h3 {
    margin-top: 25px;
    margin-bottom: 15px;
    color: var(--dark-color);
}

.news-full-content p {
    margin-bottom: 15px;
}

.news-full-content ul,
.news-full-content ol {
    margin-bottom: 20px;
    padding-left: 30px;
}

.news-full-content li {
    margin-bottom: 10px;
}

.news-contact {
    background: var(--light-color);
    padding: 20px;
    border-radius: 10px;
    margin-top: 30px;
}

.news-contact h3 {
    margin-top: 0;
    color: var(--primary-color);
}

.hide-full-btn {
    width: 100%;
    margin-top: 20px;
}

/* Пагинация */
.news-pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
    margin-top: 50px;
}

.page-btn {
    width: 50px;
    height: 50px;
    border: 2px solid var(--gray-light);
    background: white;
    color: var(--dark-color);
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    transition: all 0.3s ease;
}

.page-btn:hover:not(:disabled) {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}

.page-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.page-numbers {
    display: flex;
    gap: 5px;
}

.page-number {
    width: 45px;
    height: 45px;
    border: 2px solid var(--gray-light);
    background: white;
    color: var(--dark-color);
    border-radius: 50%;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
}

.page-number:hover,
.page-number.active {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}

/* Сообщение "Новости не найдены" */
.no-news {
    text-align: center;
    padding: 60px 20px;
}

.no-news-content i {
    color: var(--gray-light);
    margin-bottom: 20px;
}

.no-news-content h3 {
    color: var(--dark-color);
    margin-bottom: 10px;
}

.no-news-content p {
    color: var(--gray);
    margin-bottom: 30px;
}

/* Боковая колонка */
.sidebar-widget {
    background: white;
    padding: 25px;
    border-radius: 15px;
    margin-bottom: 30px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
}

.sidebar-widget h3 {
    margin-top: 0;
    margin-bottom: 20px;
    color: var(--dark-color);
    font-size: 1.3rem;
}

/* Подписка */
.subscribe-widget {
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    color: white;
}

.subscribe-widget h3 {
    color: white;
}

.subscribe-widget p {
    opacity: 0.9;
    margin-bottom: 20px;
}

.subscribe-form {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.subscribe-form input {
    padding: 12px 15px;
    border: none;
    border-radius: 30px;
    font-size: 1rem;
    outline: none;
}

.subscribe-form button {
    width: 100%;
    padding: 12px;
    border-radius: 30px;
    font-weight: 600;
}

/* Архив */
.archive-years {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 25px;
}

.year-link {
    display: inline-block;
    padding: 8px 15px;
    background: var(--light-color);
    color: var(--dark-color);
    border-radius: 20px;
    text-decoration: none;
    font-size: 0.9rem;
    font-weight: 600;
    transition: all 0.3s ease;
}

.year-link:hover,
.year-link.active {
    background: var(--primary-color);
    color: white;
}

.archive-months h4 {
    margin-bottom: 15px;
    color: var(--gray);
    font-size: 1rem;
}

.month-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
}

.month-link {
    display: block;
    padding: 8px;
    background: var(--light-color);
    color: var(--dark-color);
    border-radius: 8px;
    text-decoration: none;
    font-size: 0.85rem;
    text-align: center;
    transition: all 0.3s ease;
}

.month-link:hover {
    background: var(--primary-color);
    color: white;
}

/* Акции */
.promotion-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    background: var(--light-color);
    border-radius: 10px;
    margin-bottom: 15px;
}

.promotion-item:last-child {
    margin-bottom: 0;
}

.promotion-badge {
    width: 50px;
    height: 50px;
    background: var(--warning);
    color: var(--dark-color);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.1rem;
    flex-shrink: 0;
}

.promotion-info h4 {
    margin: 0 0 5px 0;
    font-size: 1rem;
    color: var(--dark-color);
}

.promotion-info p {
    margin: 0 0 5px 0;
    color: var(--gray);
    font-size: 0.9rem;
}

.promotion-link {
    color: var(--primary-color);
    font-size: 0.9rem;
    font-weight: 600;
    text-decoration: none;
}

.promotion-link:hover {
    text-decoration: underline;
}

/* Быстрые ссылки */
.quick-links {
    list-style: none;
    padding: 0;
    margin: 0;
}

.quick-links li {
    margin-bottom: 12px;
}

.quick-links li:last-child {
    margin-bottom: 0;
}

.quick-links a {
    display: flex;
    align-items: center;
    gap: 10px;
    color: var(--dark-color);
    text-decoration: none;
    padding: 10px;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.quick-links a:hover {
    background: var(--light-color);
    color: var(--primary-color);
    padding-left: 15px;
}

.quick-links i {
    width: 20px;
    text-align: center;
    color: var(--primary-color);
}

/* Новостная рассылка */
.newsletter-section {
    padding: 60px 0;
    margin-top: 60px;
}

.newsletter-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 50px;
}

@media (max-width: 768px) {
    .newsletter-content {
        flex-direction: column;
        text-align: center;
    }
}

.newsletter-text h2 {
    color: white;
    margin-bottom: 15px;
}

.newsletter-text p {
    opacity: 0.9;
    font-size: 1.1rem;
    margin: 0;
}

.newsletter-form {
    min-width: 400px;
}

@media (max-width: 768px) {
    .newsletter-form {
        min-width: 100%;
    }
}

.newsletter-form .form-group {
    display: flex;
    margin-bottom: 15px;
}

.newsletter-form input {
    flex-grow: 1;
    padding: 15px 20px;
    border: none;
    border-radius: 30px 0 0 30px;
    font-size: 1rem;
    outline: none;
}

.newsletter-form .btn-light {
    background: white;
    color: var(--primary-color);
    border: none;
    padding: 15px 30px;
    border-radius: 0 30px 30px 0;
    cursor: pointer;
    font-weight: 600;
    transition: background 0.3s ease;
}

.newsletter-form .btn-light:hover {
    background: #f8f9fa;
}

.form-check {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.9rem;
    opacity: 0.9;
}

.form-check input {
    width: 18px;
    height: 18px;
}

.form-check label {
    margin: 0;
}

/* Популярные новости */
.popular-news {
    padding: 60px 0;
}

.section-header {
    text-align: center;
    margin-bottom: 50px;
}

.section-subtitle {
    color: var(--gray);
    font-size: 1.1rem;
    margin-top: 10px;
}

.popular-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 30px;
}

.popular-news-item {
    background: white;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    transition: transform 0.3s ease;
}

.popular-news-item:hover {
    transform: translateY(-5px);
}

.popular-image {
    height: 200px;
    overflow: hidden;
}

.popular-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
}

.popular-news-item:hover .popular-image img {
    transform: scale(1.05);
}

.popular-content {
    padding: 25px;
}

.popular-category {
    display: inline-block;
    background: var(--light-color);
    color: var(--primary-color);
    padding: 5px 15px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
    margin-bottom: 15px;
}

.popular-content h3 {
    margin: 0 0 15px 0;
    color: var(--dark-color);
    font-size: 1.3rem;
    line-height: 1.4;
}

.popular-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    color: var(--gray);
    font-size: 0.9rem;
}

.popular-comments i {
    margin-right: 5px;
}

.read-link {
    color: var(--primary-color);
    text-decoration: none;
    font-weight: 600;
    display: inline-block;
}

.read-link:hover {
    text-decoration: underline;
}

.bg-primary {
    background: var(--primary-color) !important;
}

.text-white {
    color: white !important;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Фильтрация новостей
    const categorySelect = document.getElementById('newsCategory');
    const yearSelect = document.getElementById('newsYear');
    const sortSelect = document.getElementById('newsSort');
    const searchInput = document.getElementById('newsSearch');
    const searchButton = document.getElementById('searchNewsBtn');
    const newsItems = document.querySelectorAll('.news-item');
    const noNewsMessage = document.getElementById('noNewsMessage');
    
    function filterNews() {
        const category = categorySelect.value;
        const year = yearSelect.value;
        const sort = sortSelect.value;
        const searchQuery = searchInput.value.toLowerCase().trim();
        
        let visibleCount = 0;
        
        newsItems.forEach(item => {
            const itemCategory = item.dataset.category;
            const itemYear = item.dataset.year;
            const itemTitle = item.querySelector('.news-title').textContent.toLowerCase();
            const itemExcerpt = item.querySelector('.news-excerpt p').textContent.toLowerCase();
            
            const categoryMatch = category === 'all' || itemCategory === category;
            const yearMatch = year === 'all' || itemYear === year;
            const searchMatch = !searchQuery || 
                               itemTitle.includes(searchQuery) || 
                               itemExcerpt.includes(searchQuery);
            
            if (categoryMatch && yearMatch && searchMatch) {
                item.style.display = 'block';
                visibleCount++;
                setTimeout(() => {
                    item.style.opacity = '1';
                    item.style.transform = 'translateY(0)';
                }, 10);
            } else {
                item.style.opacity = '0';
                item.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    item.style.display = 'none';
                }, 300);
            }
        });
        
        // Показываем/скрываем сообщение
        if (visibleCount === 0) {
            noNewsMessage.style.display = 'block';
        } else {
            noNewsMessage.style.display = 'none';
        }
        
        // Сортировка
        sortNews(sort);
    }
    
    function sortNews(sortBy) {
        const container = document.getElementById('newsList');
        const items = Array.from(newsItems).filter(item => item.style.display !== 'none');
        
        items.sort((a, b) => {
            if (sortBy === 'newest') {
                return new Date(b.querySelector('.news-date').dataset.fullDate) - 
                       new Date(a.querySelector('.news-date').dataset.fullDate);
            } else {
                return new Date(a.querySelector('.news-date').dataset.fullDate) - 
                       new Date(b.querySelector('.news-date').dataset.fullDate);
            }
        });
        
        // Сохраняем fullDate в dataset для сортировки
        items.forEach(item => {
            const day = item.querySelector('.date-day').textContent;
            const month = item.querySelector('.date-month').textContent;
            const year = item.querySelector('.date-year').textContent;
            const dateStr = `${day} ${month} ${year}`;
            const date = new Date(dateStr);
            item.querySelector('.news-date').dataset.fullDate = date.toISOString();
        });
        
        // Перемещаем элементы в новом порядке
        items.forEach(item => {
            container.appendChild(item);
        });
    }
    
    // Инициализация дат для сортировки
    newsItems.forEach(item => {
        const day = item.querySelector('.date-day').textContent;
        const month = item.querySelector('.date-month').textContent;
        const year = item.querySelector('.date-year').textContent;
        const dateStr = `${day} ${month} ${year}`;
        const date = new Date(dateStr);
        item.querySelector('.news-date').dataset.fullDate = date.toISOString();
    });
    
    // Слушатели событий
    categorySelect.addEventListener('change', filterNews);
    yearSelect.addEventListener('change', filterNews);
    sortSelect.addEventListener('change', filterNews);
    searchInput.addEventListener('keyup', function(e) {
        if (e.key === 'Enter') {
            filterNews();
        }
    });
    searchButton.addEventListener('click', filterNews);
    
    // Сброс фильтров
    document.getElementById('resetNewsFilters').addEventListener('click', function() {
        categorySelect.value = 'all';
        yearSelect.value = 'all';
        sortSelect.value = 'newest';
        searchInput.value = '';
        filterNews();
    });
    
    // Раскрытие/сворачивание полного текста новости
    const readMoreButtons = document.querySelectorAll('.read-more-btn');
    const hideButtons = document.querySelectorAll('.hide-full-btn');
    
    readMoreButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            
            const newsItem = this.closest('.news-item');
            const fullContent = newsItem.querySelector('.news-full');
            const isVisible = fullContent.style.display === 'block';
            
            // Скрываем все открытые новости
            document.querySelectorAll('.news-full').forEach(content => {
                content.style.display = 'none';
                content.previousElementSibling.querySelector('.read-more-btn').innerHTML = 
                    '<i class="fas fa-newspaper"></i> Подробнее';
            });
            
            // Показываем/скрываем текущую новость
            if (!isVisible) {
                fullContent.style.display = 'block';
                this.innerHTML = '<i class="fas fa-times"></i> Скрыть';
                
                // Плавная прокрутка к началу новости
                newsItem.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        });
    });
    
    hideButtons.forEach(button => {
        button.addEventListener('click', function() {
            const fullContent = this.closest('.news-full');
            const newsItem = fullContent.closest('.news-item');
            const readMoreBtn = newsItem.querySelector('.read-more-btn');
            
            fullContent.style.display = 'none';
            readMoreBtn.innerHTML = '<i class="fas fa-newspaper"></i> Подробнее';
        });
    });
    
    // Поделиться в соцсетях
    const shareButtons = document.querySelectorAll('.share-btn');
    
    shareButtons.forEach(button => {
        button.addEventListener('click', function() {
            const platform = this.dataset.platform;
            const title = this.dataset.title;
            const url = window.location.href + this.closest('.news-item').id;
            
            let shareUrl = '';
            
            switch(platform) {
                case 'vk':
                    shareUrl = `https://vk.com/share.php?url=${encodeURIComponent(url)}&title=${encodeURIComponent(title)}`;
                    break;
                case 'telegram':
                    shareUrl = `https://t.me/share/url?url=${encodeURIComponent(url)}&text=${encodeURIComponent(title)}`;
                    break;
            }
            
            if (shareUrl) {
                window.open(shareUrl, '_blank', 'width=600,height=400');
            }
        });
    });
    
    // Подписка на новости (виджет)
    const subscribeForm = document.querySelector('.subscribe-form');
    
    subscribeForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const email = this.querySelector('input[type="email"]').value.trim();
        
        if (!email) {
            alert('Пожалуйста, введите email');
            return;
        }
        
        alert(`Спасибо за подписку! На адрес ${email} будут приходить новости клиники.`);
        this.reset();
    });
    
    // Подписка на рассылку (нижняя форма)
    const newsletterForm = document.querySelector('.newsletter-form');
    
    newsletterForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const email = this.querySelector('input[type="email"]').value.trim();
        const agree = this.querySelector('input[type="checkbox"]').checked;
        
        if (!agree) {
            alert('Пожалуйста, согласитесь на обработку персональных данных');
            return;
        }
        
        alert(`Спасибо за подписку на рассылку! На адрес ${email} будут приходить важные новости.`);
        this.reset();
    });
    
    // Архив новостей
    const yearLinks = document.querySelectorAll('.year-link');
    const monthLinks = document.querySelectorAll('.month-link');
    
    yearLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            
            yearLinks.forEach(l => l.classList.remove('active'));
            this.classList.add('active');
            
            // Фильтрация по году
            yearSelect.value = this.textContent;
            filterNews();
        });
    });
    
    monthLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            
            monthLinks.forEach(l => l.classList.remove('active'));
            this.classList.add('active');
            
            // Здесь можно добавить фильтрацию по месяцу
            alert(`Показать новости за ${this.textContent}`);
        });
    });
    
    // Пагинация
    const pageNumbers = document.querySelectorAll('.page-number');
    const prevButton = document.querySelector('.page-btn.prev');
    const nextButton = document.querySelector('.page-btn.next');
    
    let currentPage = 1;
    const newsPerPage = 5;
    const totalNews = newsItems.length;
    const totalPages = Math.ceil(totalNews / newsPerPage);
    
    function updatePagination() {
        // Обновляем активную страницу
        pageNumbers.forEach((number, index) => {
            if (index + 1 === currentPage) {
                number.classList.add('active');
            } else {
                number.classList.remove('active');
            }
        });
        
        // Обновляем состояние кнопок
        prevButton.disabled = currentPage === 1;
        nextButton.disabled = currentPage === totalPages;
        
        // Показываем/скрываем новости постранично
        let visibleIndex = 0;
        newsItems.forEach((item, index) => {
            if (item.style.display !== 'none') {
                visibleIndex++;
                const page = Math.ceil(visibleIndex / newsPerPage);
                if (page === currentPage) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            }
        });
    }
    
    pageNumbers.forEach(number => {
        number.addEventListener('click', function() {
            currentPage = parseInt(this.textContent);
            updatePagination();
        });
    });
    
    prevButton.addEventListener('click', function() {
        if (currentPage > 1) {
            currentPage--;
            updatePagination();
        }
    });
    
    nextButton.addEventListener('click', function() {
        if (currentPage < totalPages) {
            currentPage++;
            updatePagination();
        }
    });
    
    // Инициализация пагинации
    updatePagination();
});
</script>
{% endblock %}