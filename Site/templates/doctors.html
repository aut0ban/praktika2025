{% extends base_template %}

{% block title %}Наши врачи - Ветеринарная клиника "Друг"{% endblock %}

{% block content %}
<!-- Заголовок страницы -->
<div class="page-header">
    <div class="container">
        <h1>Наши врачи</h1>
        <p>Профессиональная команда ветеринарных специалистов</p>
    </div>
</div>

<!-- Фильтр специалистов -->
<section class="doctors-filter">
    <div class="container">
        <div class="filter-section">
            <h3>Фильтр по специализации</h3>
            <div class="specialization-filter">
                <button class="spec-btn active" data-spec="all">Все специалисты</button>
                {% for spec in specializations %}
                <button class="spec-btn" data-spec="{{ spec[0] }}">{{ spec[0] }}</button>
                {% endfor %}
            </div>
        </div>
        
        <div class="filter-section">
            <h3>Фильтр по опыту</h3>
            <div class="experience-filter">
                <button class="exp-btn active" data-exp="all">Любой опыт</button>
                <button class="exp-btn" data-exp="5">До 5 лет</button>
                <button class="exp-btn" data-exp="10">5-10 лет</button>
                <button class="exp-btn" data-exp="15">Более 10 лет</button>
            </div>
        </div>
    </div>
</section>

<!-- Список врачей -->
<section class="doctors-list">
    <div class="container">
        <div class="doctors-container">
            {% for doctor in doctors %}
            <div class="doctor-profile" id="doctor-{{ doctor.id }}" 
                 data-specialization="{{ doctor.specialization }}"
                 data-experience="{{ doctor.experience }}">
                <div class="doctor-main">
                    <div class="doctor-photo">
                        <img src="{{ url_for('static', filename=doctor.photo_url) }}" alt="{{ doctor.name }}">
                        {% if doctor.experience >= 10 %}
                        <span class="expert-badge">Эксперт</span>
                        {% endif %}
                    </div>
                    
                    <div class="doctor-info">
                        <h2>{{ doctor.name }}</h2>
                        <p class="specialization">{{ doctor.specialization }}</p>
                        
                        <div class="doctor-stats">
                            <div class="stat">
                                <i class="fas fa-briefcase"></i>
                                <div>
                                    <strong>Опыт работы</strong>
                                    <span>{{ doctor.experience }} лет</span>
                                </div>
                            </div>
                            
                            <div class="stat">
                                <i class="fas fa-calendar-alt"></i>
                                <div>
                                    <strong>График работы</strong>
                                    <span>{{ doctor.schedule }}</span>
                                </div>
                            </div>
                            
                            <div class="stat">
                                <i class="fas fa-star"></i>
                                <div>
                                    <strong>Рейтинг</strong>
                                    <span>4.9/5.0</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="doctor-actions">
                            <a href="{{ url_for('contacts') }}?doctor={{ doctor.id }}" class="btn btn-primary">
                                <i class="fas fa-calendar-plus"></i> Записаться
                            </a>
                            <button class="btn btn-outline toggle-bio">
                                <i class="fas fa-user-md"></i> Подробнее
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="doctor-details">
                    <div class="details-content">
                        <div class="detail-section">
                            <h4><i class="fas fa-graduation-cap"></i> Образование</h4>
                            <p>{{ doctor.education }}</p>
                        </div>
                        
                        <div class="detail-section">
                            <h4><i class="fas fa-tasks"></i> Основные направления</h4>
                            <div class="specialties">
                                {% set specialties = doctor.specialization.split(',') %}
                                {% for specialty in specialties %}
                                <span class="specialty-tag">{{ specialty.strip() }}</span>
                                {% endfor %}
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <h4><i class="fas fa-heart"></i> О враче</h4>
                            <p>{{ doctor.bio }}</p>
                        </div>
                        
                        <div class="detail-section">
                            <h4><i class="fas fa-comment-medical"></i> Отзывы пациентов</h4>
                            <div class="reviews-preview">
                                <div class="review">
                                    <p>"{{ doctor.name.split()[0] }} - прекрасный специалист! Очень внимательный и профессиональный подход."</p>
                                    <span class="review-author">Елена К.</span>
                                </div>
                                <div class="review">
                                    <p>"Спасибо доктору за спасение нашего питомца. Настоящий профессионал своего дела!"</p>
                                    <span class="review-author">Александр М.</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Статистика -->
<section class="stats-section bg-light">
    <div class="container">
        <div class="stats-grid">
            <div class="stat-card">
                <i class="fas fa-user-md fa-3x"></i>
                <div class="stat-numbers">
                    <span class="count" data-count="{{ doctors|length }}">0</span>+
                </div>
                <p>Квалифицированных врачей</p>
            </div>
            
            <div class="stat-card">
                <i class="fas fa-stethoscope fa-3x"></i>
                <div class="stat-numbers">
                    <span class="count" data-count="15">0</span>+
                </div>
                <p>Направлений специализации</p>
            </div>
            
            <div class="stat-card">
                <i class="fas fa-users fa-3x"></i>
                <div class="stat-numbers">
                    <span class="count" data-count="10000">0</span>+
                </div>
                <p>Довольных пациентов</p>
            </div>
            
            <div class="stat-card">
                <i class="fas fa-award fa-3x"></i>
                <div class="stat-numbers">
                    <span class="count" data-count="50">0</span>+
                </div>
                <p>Профессиональных наград</p>
            </div>
        </div>
    </div>
</section>

<!-- Как выбрать врача -->
<section class="choose-doctor">
    <div class="container">
        <div class="section-header">
            <h2>Как выбрать врача для питомца?</h2>
            <p class="section-subtitle">Рекомендации по выбору специалиста</p>
        </div>
        
        <div class="choose-grid">
            <div class="choose-card">
                <div class="choose-number">01</div>
                <h3>Определите проблему</h3>
                <p>Оцените состояние питомца и определите, к какому специалисту нужно обратиться: терапевту, хирургу, дерматологу и т.д.</p>
            </div>
            
            <div class="choose-card">
                <div class="choose-number">02</div>
                <h3>Изучите специализации</h3>
                <p>Ознакомьтесь с информацией о врачах, их образовании, опыте и основных направлениях работы.</p>
            </div>
            
            <div class="choose-card">
                <div class="choose-number">03</div>
                <h3>Прочитайте отзывы</h3>
                <p>Обратите внимание на отзывы других владельцев животных о работе конкретных специалистов.</p>
            </div>
            
            <div class="choose-card">
                <div class="choose-number">04</div>
                <h3>Учитывайте график</h3>
                <p>Выберите врача с удобным для вас графиком работы и возможностью записи на подходящее время.</p>
            </div>
        </div>
        
        <div class="consultation-box">
            <div class="consultation-content">
                <h3>Не знаете, к какому врачу обратиться?</h3>
                <p>Позвоните нам, и администратор поможет подобрать подходящего специалиста для вашего питомца</p>
                <a href="tel:+74951234567" class="btn btn-primary btn-lg">
                    <i class="fas fa-phone"></i> +7 (495) 123-45-67
                </a>
            </div>
        </div>
    </div>
</section>

<!-- Расписание врачей -->
<section class="schedule-section bg-light">
    <div class="container">
        <div class="section-header">
            <h2>Расписание врачей</h2>
            <p class="section-subtitle">График работы специалистов на текущую неделю</p>
        </div>
        
        <div class="schedule-table-container">
            <table class="schedule-table">
                <thead>
                    <tr>
                        <th>Врач</th>
                        <th>Понедельник</th>
                        <th>Вторник</th>
                        <th>Среда</th>
                        <th>Четверг</th>
                        <th>Пятница</th>
                        <th>Суббота</th>
                    </tr>
                </thead>
                <tbody>
                    {% for doctor in doctors[:5] %}
                    <tr>
                        <td>
                            <strong>{{ doctor.name.split()[0] }} {{ doctor.name.split()[1][0] }}.</strong>
                            <br><small>{{ doctor.specialization.split(',')[0] }}</small>
                        </td>
                        {% for day in ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'] %}
                        <td>
                            {% if doctor.schedule %}
                                {% if 'Пн-Пт' in doctor.schedule and day in ['Пн', 'Вт', 'Ср', 'Чт', 'Пт'] %}
                                    <span class="available">9:00-18:00</span>
                                {% elif 'Вт-Сб' in doctor.schedule and day in ['Вт', 'Ср', 'Чт', 'Пт', 'Сб'] %}
                                    <span class="available">10:00-19:00</span>
                                {% elif 'Пн-Ср-Пт' in doctor.schedule and day in ['Пн', 'Ср', 'Пт'] %}
                                    <span class="available">8:00-17:00</span>
                                {% elif 'Вт-Чт-Сб' in doctor.schedule and day in ['Вт', 'Чт', 'Сб'] %}
                                    <span class="available">9:00-18:00</span>
                                {% else %}
                                    <span class="unavailable">—</span>
                                {% endif %}
                            {% else %}
                                <span class="available">9:00-18:00</span>
                            {% endif %}
                        </td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <div class="schedule-legend">
            <div class="legend-item">
                <span class="legend-color available"></span>
                <span>Прием ведется</span>
            </div>
            <div class="legend-item">
                <span class="legend-color unavailable"></span>
                <span>Выходной</span>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_css %}
<style>
.page-header {
    background: linear-gradient(135deg, var(--primary-color), var(--dark-color));
    color: white;
    padding: 80px 0;
    text-align: center;
    margin-bottom: 40px;
}

.page-header h1 {
    color: white;
    font-size: 3rem;
    margin-bottom: 15px;
}

.doctors-filter {
    background: white;
    padding: 30px 0;
    border-bottom: 1px solid var(--gray-light);
    margin-bottom: 30px;
}

.filter-section {
    margin-bottom: 30px;
}

.filter-section:last-child {
    margin-bottom: 0;
}

.filter-section h3 {
    margin-bottom: 15px;
    color: var(--dark-color);
}

.specialization-filter,
.experience-filter {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.spec-btn,
.exp-btn {
    padding: 10px 20px;
    border: 2px solid var(--gray-light);
    background: white;
    color: var(--gray);
    border-radius: 30px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 600;
}

.spec-btn:hover,
.spec-btn.active,
.exp-btn:hover,
.exp-btn.active {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}

.doctor-profile {
    background: white;
    border-radius: 15px;
    margin-bottom: 30px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    overflow: hidden;
    transition: transform 0.3s ease;
}

.doctor-profile:hover {
    transform: translateY(-5px);
}

.doctor-main {
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 40px;
    padding: 40px;
}

.doctor-photo {
    position: relative;
}

.doctor-photo img {
    width: 100%;
    height: 300px;
    object-fit: cover;
    border-radius: 10px;
}

.expert-badge {
    position: absolute;
    top: 15px;
    right: 15px;
    background: var(--warning);
    color: var(--dark-color);
    padding: 5px 15px;
    border-radius: 20px;
    font-weight: bold;
    font-size: 0.9rem;
}

.doctor-info h2 {
    color: var(--dark-color);
    margin-bottom: 10px;
}

.specialization {
    color: var(--primary-color);
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 30px;
}

.doctor-stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin: 30px 0;
}

.stat {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    background: var(--light-color);
    border-radius: 10px;
}

.stat i {
    font-size: 1.5rem;
    color: var(--primary-color);
}

.stat strong {
    display: block;
    color: var(--gray);
    font-size: 0.9rem;
}

.stat span {
    display: block;
    font-weight: 600;
    color: var(--dark-color);
    font-size: 1.1rem;
}

.doctor-actions {
    display: flex;
    gap: 15px;
    margin-top: 30px;
}

.doctor-details {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.5s ease;
    background: var(--light-color);
}

.doctor-details.expanded {
    max-height: 1000px;
}

.details-content {
    padding: 40px;
    border-top: 1px solid rgba(0,0,0,0.1);
}

.detail-section {
    margin-bottom: 30px;
}

.detail-section:last-child {
    margin-bottom: 0;
}

.detail-section h4 {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
    color: var(--dark-color);
}

.detail-section h4 i {
    color: var(--primary-color);
}

.specialties {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.specialty-tag {
    background: white;
    padding: 8px 20px;
    border-radius: 20px;
    font-size: 0.9rem;
    border: 1px solid var(--gray-light);
}

.reviews-preview {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.review {
    background: white;
    padding: 20px;
    border-radius: 10px;
    border-left: 4px solid var(--primary-color);
}

.review-author {
    display: block;
    margin-top: 10px;
    font-style: italic;
    color: var(--gray);
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 30px;
    padding: 60px 0;
}

.stat-card {
    text-align: center;
}

.stat-card i {
    color: var(--primary-color);
    margin-bottom: 20px;
}

.stat-numbers {
    font-size: 3rem;
    font-weight: bold;
    color: var(--dark-color);
    margin-bottom: 10px;
}

.stat-numbers .count {
    color: var(--primary-color);
}

.choose-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 30px;
    margin: 50px 0;
}

.choose-card {
    background: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    position: relative;
}

.choose-number {
    position: absolute;
    top: -20px;
    left: -20px;
    background: var(--primary-color);
    color: white;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    font-weight: bold;
}

.consultation-box {
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    color: white;
    padding: 50px;
    border-radius: 15px;
    text-align: center;
    margin-top: 50px;
}

.consultation-content h3 {
    color: white;
    margin-bottom: 15px;
}

.consultation-content p {
    opacity: 0.9;
    margin-bottom: 30px;
    font-size: 1.1rem;
}

.schedule-table-container {
    overflow-x: auto;
    margin: 30px 0;
}

.schedule-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
}

.schedule-table th {
    background: var(--primary-color);
    color: white;
    padding: 20px;
    text-align: center;
    font-weight: 600;
}

.schedule-table td {
    padding: 20px;
    text-align: center;
    border: 1px solid var(--gray-light);
}

.schedule-table tr:nth-child(even) {
    background: var(--light-color);
}

.available {
    color: var(--success);
    font-weight: 600;
}

.unavailable {
    color: var(--gray);
    font-style: italic;
}

.schedule-legend {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin-top: 30px;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 10px;
}

.legend-color {
    width: 20px;
    height: 20px;
    border-radius: 4px;
}

.legend-color.available {
    background: var(--success);
}

.legend-color.unavailable {
    background: var(--gray);
}

.btn-lg {
    padding: 15px 40px;
    font-size: 1.2rem;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Фильтрация врачей
    const specButtons = document.querySelectorAll('.spec-btn');
    const expButtons = document.querySelectorAll('.exp-btn');
    const doctorProfiles = document.querySelectorAll('.doctor-profile');
    
    function filterDoctors() {
        const activeSpec = document.querySelector('.spec-btn.active').dataset.spec;
        const activeExp = document.querySelector('.exp-btn.active').dataset.exp;
        
        doctorProfiles.forEach(profile => {
            const specialization = profile.dataset.specialization;
            const experience = parseInt(profile.dataset.experience);
            
            let specMatch = activeSpec === 'all' || specialization.includes(activeSpec);
            let expMatch = activeExp === 'all' || 
                          (activeExp === '5' && experience <= 5) ||
                          (activeExp === '10' && experience > 5 && experience <= 10) ||
                          (activeExp === '15' && experience > 10);
            
            if (specMatch && expMatch) {
                profile.style.display = 'block';
                setTimeout(() => {
                    profile.style.opacity = '1';
                    profile.style.transform = 'translateY(0)';
                }, 10);
            } else {
                profile.style.opacity = '0';
                profile.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    profile.style.display = 'none';
                }, 300);
            }
        });
    }
    
    specButtons.forEach(button => {
        button.addEventListener('click', function() {
            specButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            filterDoctors();
        });
    });
    
    expButtons.forEach(button => {
        button.addEventListener('click', function() {
            expButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            filterDoctors();
        });
    });
    
    // Раскрытие подробной информации о враче
    const toggleButtons = document.querySelectorAll('.toggle-bio');
    
    toggleButtons.forEach(button => {
        button.addEventListener('click', function() {
            const details = this.closest('.doctor-profile').querySelector('.doctor-details');
            const isExpanded = details.classList.contains('expanded');
            
            // Закрываем все остальные
            document.querySelectorAll('.doctor-details').forEach(d => {
                d.classList.remove('expanded');
                d.previousElementSibling.querySelector('.toggle-bio').innerHTML = 
                    '<i class="fas fa-user-md"></i> Подробнее';
            });
            
            // Открываем/закрываем текущий
            if (!isExpanded) {
                details.classList.add('expanded');
                this.innerHTML = '<i class="fas fa-times"></i> Скрыть';
            }
        });
    });
    
    // Анимация счетчиков статистики
    const countElements = document.querySelectorAll('.count');
    
    function animateCounters() {
        countElements.forEach(element => {
            const target = parseInt(element.dataset.count);
            const duration = 2000; // 2 секунды
            const increment = target / (duration / 16); // 60fps
            let current = 0;
            
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    element.textContent = target;
                    clearInterval(timer);
                } else {
                    element.textContent = Math.floor(current);
                }
            }, 16);
        });
    }
    
    // Запуск анимации при прокрутке до секции
    const statsSection = document.querySelector('.stats-section');
    
    function checkScroll() {
        const sectionTop = statsSection.offsetTop;
        const sectionHeight = statsSection.offsetHeight;
        const scrollTop = window.pageYOffset;
        const windowHeight = window.innerHeight;
        
        if (scrollTop > sectionTop - windowHeight + 100) {
            animateCounters();
            window.removeEventListener('scroll', checkScroll);
        }
    }
    
    window.addEventListener('scroll', checkScroll);
    checkScroll(); // Проверка при загрузке
    
    // Плавная прокрутка к якорям
    const anchorLinks = document.querySelectorAll('a[href^="#"]');
    
    anchorLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            const href = this.getAttribute('href');
            if (href.startsWith('#doctor-')) {
                e.preventDefault();
                const target = document.querySelector(href);
                if (target) {
                    // Открываем детали врача
                    const details = target.querySelector('.doctor-details');
                    if (details && !details.classList.contains('expanded')) {
                        target.querySelector('.toggle-bio').click();
                    }
                    
                    // Прокрутка
                    window.scrollTo({
                        top: target.offsetTop - 100,
                        behavior: 'smooth'
                    });
                }
            }
        });
    });
});
</script>
{% endblock %}
